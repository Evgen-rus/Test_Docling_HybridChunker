from docling.chunking import HybridChunker
from docling.document_converter import DocumentConverter
from dotenv import load_dotenv
from openai import OpenAI

load_dotenv()

# Initialize OpenAI client
client = OpenAI()

print("üöÄ –ù–∞—á–∏–Ω–∞—é –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–±–∏–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã...")

# --------------------------------------------------------------
# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
# --------------------------------------------------------------

converter = DocumentConverter()
print("üìÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –¥–æ–∫—É–º–µ–Ω—Ç...")
result = converter.convert("documents/–õ–û–ì–ò–ö–ê_–ü–†–û–î–ê–ñ–ò_–¢–ï–°–¢–û–í–û–ì–û_–ü–ï–†–ò–û–î–ê_–õ–ò–î–ì–ï–ù–ë–Æ–†–û.md")

# --------------------------------------------------------------
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è (–ù–û–í–´–ô API)
# --------------------------------------------------------------

print("üîß –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é HybridChunker...")
# –ù–æ–≤—ã–π API HybridChunker
chunker = HybridChunker(
    chunk_size=1024,  # –í–º–µ—Å—Ç–æ max_tokens
    overlap=100       # –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –º–µ–∂–¥—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º–∏
)

print("‚úÇÔ∏è –†–∞–∑–±–∏–≤–∞—é –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ —Å–º—ã—Å–ª–æ–≤—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã...")
chunk_iter = chunker.chunk(dl_doc=result.document)
chunks = list(chunk_iter)

print(f"‚úÖ –†–∞–∑–±–∏–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
print(f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
print(f"   ‚Ä¢ –í—Å–µ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤: {len(chunks)}")
print(f"   ‚Ä¢ –†–∞–∑–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞: –¥–æ 1024 —Ç–æ–∫–µ–Ω–æ–≤")

# --------------------------------------------------------------
# –ê–Ω–∞–ª–∏–∑ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
# --------------------------------------------------------------

print("\n" + "="*60)
print("–ê–ù–ê–õ–ò–ó –°–û–ó–î–ê–ù–ù–´–• –§–†–ê–ì–ú–ï–ù–¢–û–í:")
print("="*60)

for i, chunk in enumerate(chunks[:3]):  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 3 —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞
    print(f"\nüìã –§—Ä–∞–≥–º–µ–Ω—Ç {i+1}:")
    print(f"   ‚Ä¢ –†–∞–∑–º–µ—Ä: {len(chunk.text)} —Å–∏–º–≤–æ–ª–æ–≤")
    print(f"   ‚Ä¢ –ó–∞–≥–æ–ª–æ–≤–∫–∏: {chunk.meta.headings if chunk.meta.headings else '–ù–µ—Ç'}")
    print(f"   ‚Ä¢ –ü—Ä–µ–≤—å—é: {chunk.text[:200]}...")

if len(chunks) > 3:
    print(f"\n... –∏ –µ—â–µ {len(chunks) - 3} —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤")

print(f"\nüíæ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –≥–æ—Ç–æ–≤–æ –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞: {len(chunks)}")